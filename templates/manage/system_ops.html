{% extends "base.html" %}
{% block title %}系統維運{% endblock %}

{% block content %}
<div class="row g-3 align-items-center mb-3">
  <div class="col">
    <h4 class="mb-0">系統維運</h4>
    <div class="text-muted small">清空資料、匯出資料、重建快取</div>
  </div>
</div>

<div class="row g-3">
  <!-- 清空資料 -->
  <div class="col-12 col-md-6 col-xl-4">
    <div class="card shadow-sm border-0 h-100">
      <div class="card-body d-flex flex-column">
        <div class="display-6 mb-2">🗑️</div>
        <h6 class="card-title">清空資料</h6>
        <p class="text-muted small flex-grow-1">刪除指定集合內所有資料（<span class="text-danger">請小心</span>）</p>
        <form action="{{ url_for('clear_data') }}" method="post"
              onsubmit="return confirm('確定要清空指定集合嗎？此動作無法復原！')">
          <button class="btn btn-danger w-100">執行</button>
        </form>
      </div>
    </div>
  </div>

  <!-- 匯出資料 -->
  <div class="col-12 col-md-6 col-xl-4">
    <div class="card shadow-sm border-0 h-100">
      <div class="card-body d-flex flex-column">
        <div class="display-6 mb-2">📁</div>
        <h6 class="card-title">匯出資料</h6>
        <p class="text-muted small flex-grow-1">將多個集合匯出為 CSV 並打包 ZIP 下載</p>
        <form action="{{ url_for('export_data') }}" method="post">
          <button class="btn btn-warning w-100">執行</button>
        </form>
      </div>
    </div>
  </div>

  <!-- 重新整理快取 -->
  <div class="col-12 col-md-6 col-xl-4">
    <div class="card shadow-sm border-0 h-100">
      <div class="card-body d-flex flex-column">
        <div class="display-6 mb-2">🔄</div>
        <h6 class="card-title">重新整理快取</h6>
        <p class="text-muted small flex-grow-1">刪除並重建伺服器上的 <code>./cache</code> 目錄</p>
        <form action="{{ url_for('refresh_cache') }}" method="post">
          <button class="btn btn-info text-white w-100">執行</button>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="card shadow-sm border-0 mt-4">
  <div class="card-body small text-muted">
    💡 可在 <code>app.py</code> 調整 <code>EXPORT_COLLECTIONS</code> / <code>CLEAR_COLLECTIONS</code>，並於環境變數設 <code>MONGO_URL</code>。
  </div>
</div>
{% endblock %}
